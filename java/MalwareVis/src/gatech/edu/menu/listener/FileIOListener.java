package gatech.edu.menu.listener;
import gatech.edu.Window;
import gatech.edu.pcap.Pcap;
import gatech.edu.pcap.Pcaps;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import javax.swing.JFileChooser;
import javax.swing.JPanel;
import javax.swing.JTextArea;
import java.io.*;

public class FileIOListener extends JPanel 
					implements ActionListener {

	JFileChooser jfc;
	JTextArea txtarea;
	public ArrayList<Pcap>pcap_list;
	public Pcaps pcaps; 
	Window window;
	
	public FileIOListener(Window w){
		window = w;
		txtarea = new JTextArea(5,20);
		txtarea.setMargin(new Insets(5,5,5,5));
		txtarea.setEditable(false);
		jfc = new JFileChooser();
		try {
		    File f = new File(new File(".").getCanonicalPath());
		    jfc.setCurrentDirectory(f);
		} catch (IOException e) {
			e.printStackTrace(); 
		}
		jfc.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);
	}
	
	@Override
	public void actionPerformed(ActionEvent e) {
		if(e.getActionCommand().equals("Open Pcaps")||
				e.getActionCommand().equals("Open Entities")){
			int retval = jfc.showOpenDialog(FileIOListener.this);
			if(retval == JFileChooser.APPROVE_OPTION){
				File file = jfc.getSelectedFile();
				populateTable(file);
			} else {
				txtarea.append("Open File command failed");
			}
			txtarea.setCaretPosition(txtarea.getDocument().getLength());
		}  else if(e.getActionCommand().equals("Save Pcaps to Entities")){
			int retval = jfc.showSaveDialog(FileIOListener.this);
			if(retval == JFileChooser.APPROVE_OPTION){
				System.out.println("save to txt files...");
				for (Pcap pcap: pcap_list) pcap.saveFile(); 
				}
			}
		else if(e.getActionCommand().equals("Save Pcaps")){
			//int ret = jfc.showSaveDialog(FileIOListener.this);
			System.out.println("save to a txt file...");
			window.tbframe.pcaps.saveFile(); 
			txtarea.setCaretPosition(txtarea.getDocument().getLength());
			}
	}
	public void populateTable(File pd){
		System.out.println("Creating new frame");
		Pcaps p = new Pcaps(pd.getAbsolutePath());
		pcaps = p;
		pcap_list = p.getPcapList(); 
		System.out.println("set pcaps"); 
		window.createTableFrame(pcaps);
		if(window == null){
			System.err.println("Initialize SaveOpenListener before use");
			System.exit(1);
		}
	}
}